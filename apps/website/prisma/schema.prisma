// This is your Prisma schema file,
// learn more about it in the docs: https://pris.ly/d/prisma-schema

generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "sqlite"
  url      = env("DATABASE_URL")
}

// User Authentication
model User {
  id            String   @id @default(cuid())
  email         String   @unique
  password      String
  name          String?
  role          UserRole @default(EDITOR)
  createdAt     DateTime @default(now())
  updatedAt     DateTime @updatedAt
  
  blogPosts     BlogPost[]
}

enum UserRole {
  ADMIN
  EDITOR
}

// Services Management
model Service {
  id              String   @id @default(cuid())
  slug            String   @unique
  name            String
  shortDescription String
  description     String
  icon            String?
  
  // SEO Fields
  metaTitle       String?
  metaDescription String?
  keywords        String?
  
  // Content
  benefits        String   // JSON array
  process         String   // JSON array
  faqs            String   // JSON array
  
  // Schema Toggles
  enableFAQSchema Boolean  @default(true)
  enableServiceSchema Boolean @default(true)
  
  // Status
  published       Boolean  @default(true)
  featured        Boolean  @default(false)
  
  createdAt       DateTime @default(now())
  updatedAt       DateTime @updatedAt
  
  // Relations
  locationPages   LocationPage[]
  reviews         Review[]
}

// Cities / Locations Management
model City {
  id              String   @id @default(cuid())
  name            String
  slug            String   @unique
  state           String
  zipCode         String?
  
  // SEO Fields
  metaTitle       String?
  metaDescription String?
  keywords        String?
  
  // Location Data
  neighborhoods   String   // JSON array
  latitude        Float?
  longitude       Float?
  
  // Content
  description     String?
  localContent    String?
  
  // Status
  published       Boolean  @default(true)
  
  createdAt       DateTime @default(now())
  updatedAt       DateTime @updatedAt
  
  // Relations
  locationPages   LocationPage[]
  reviews         Review[]
  blogPosts       BlogPost[]
}

// Location-Based Landing Pages (Programmatic)
model LocationPage {
  id              String   @id @default(cuid())
  type            LocationPageType
  slug            String   @unique
  
  // Relations
  cityId          String
  city            City     @relation(fields: [cityId], references: [id], onDelete: Cascade)
  serviceId       String?
  service         Service? @relation(fields: [serviceId], references: [id], onDelete: SetNull)
  
  // SEO Fields
  metaTitle       String?
  metaDescription String?
  keywords        String?
  
  // Content
  headline        String?
  content         String?
  
  // Auto-generated or custom
  autoGenerated   Boolean  @default(true)
  
  createdAt       DateTime @default(now())
  updatedAt       DateTime @updatedAt
  
  @@index([cityId])
  @@index([serviceId])
}

enum LocationPageType {
  GENERAL         // /flooring-installer-[city]
  SERVICE_CITY    // /hardwood-flooring-[city]
}

// Blog Posts
model BlogPost {
  id              String   @id @default(cuid())
  title           String
  slug            String   @unique
  
  // SEO Fields
  metaTitle       String?
  metaDescription String?
  keywords        String?
  
  // Content
  excerpt         String
  content         String
  featuredImage   String?
  
  // Categorization
  category        String?
  tags            String   // JSON array
  
  // Location Targeting
  cityId          String?
  city            City?    @relation(fields: [cityId], references: [id], onDelete: SetNull)
  
  // Status
  published       Boolean  @default(false)
  publishedAt     DateTime?
  
  // Author
  authorId        String
  author          User     @relation(fields: [authorId], references: [id])
  
  createdAt       DateTime @default(now())
  updatedAt       DateTime @updatedAt
  
  @@index([published])
  @@index([cityId])
}

// Reviews Management
model Review {
  id              String   @id @default(cuid())
  authorName      String
  rating          Int      // 1-5
  text            String
  
  // Location/Service Targeting
  cityId          String?
  city            City?    @relation(fields: [cityId], references: [id], onDelete: SetNull)
  serviceId       String?
  service         Service? @relation(fields: [serviceId], references: [id], onDelete: SetNull)
  
  // Metadata
  verified        Boolean  @default(false)
  featured        Boolean  @default(false)
  date            DateTime @default(now())
  
  createdAt       DateTime @default(now())
  updatedAt       DateTime @updatedAt
  
  @@index([cityId])
  @@index([serviceId])
  @@index([featured])
}

// Leads Management
model Lead {
  id              String   @id @default(cuid())
  
  // Contact Info
  name            String
  email           String
  phone           String
  
  // Lead Details
  service         String?
  city            String?
  message         String?
  
  // Source Tracking
  source          String?  // form, phone, chat, etc.
  page            String?  // URL where lead was captured
  
  // Status
  status          LeadStatus @default(NEW)
  notes           String?
  
  // CRM Integration
  crmId           String?
  syncedAt        DateTime?
  
  createdAt       DateTime @default(now())
  updatedAt       DateTime @updatedAt
  
  @@index([status])
  @@index([createdAt])
}

enum LeadStatus {
  NEW
  CONTACTED
  QUALIFIED
  CONVERTED
  LOST
}
